<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Investimentos</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/enhanced-charts.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <!-- Navbar (será carregado via JavaScript) -->
    <div id="navbar-container"></div>

    <div class="container">
        <h1>Simulador de Investimentos <i class="fas fa-coins"></i></h1>
        
        <div class="educational-tips">
            <h3>Dicas de Investimento <span class="help-icon" onclick="toggleTips()">?</span></h3>
            <div id="tipsContent" class="concept-explanation" style="display: none;">
                <h4><i>Estratégias para Investir Melhor</i></h4>
                <ul>
                    <li><strong>Regularidade:</strong> Investir regularmente, mesmo que valores pequenos, gera um impacto significativo no longo prazo graças ao poder dos juros compostos.</li>
                    <li><strong>Horizonte Temporal:</strong> Quanto maior o prazo de investimento, maior o potencial de crescimento do seu patrimônio.</li>
                    <li><strong>Diversificação:</strong> Distribua seus investimentos entre diferentes classes de ativos para reduzir riscos.</li>
                    <li><strong>Reinvestimento:</strong> Reinvestir os rendimentos é fundamental para amplificar o efeito dos juros compostos.</li>
                </ul>
            </div>
        </div>
        
        <!-- Simulação Global -->
        <section class="mt-4">
            <h2>Simulação Global <i class="fas fa-globe"></i></h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="aporteMensal">Aporte Mensal (R$):</label>
                        <input type="number" id="aporteMensal" class="form-control" placeholder="Exemplo: 1000" value="500">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="taxaMensal">Taxa Mensal (%):</label>
                        <input type="number" id="taxaMensal" class="form-control" placeholder="Exemplo: 0.83" value="0.83" step="0.01">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="quantidadeMeses">Quantidade de Meses:</label>
                        <input type="number" id="quantidadeMeses" class="form-control" placeholder="Exemplo: 36" value="60">
                    </div>
                </div>
            </div>
            <button onclick="calcularSimulacaoGlobal()" class="btn btn-primary mt-3">Simular <i class="fas fa-calculator"></i></button>
            
            <div class="results mt-4">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Valor Futuro Total:</strong> <span id="valorFuturoGlobal">R$ 0,00</span></p>
                        <p><strong>Total Investido:</strong> <span id="totalInvestidoGlobal">R$ 0,00</span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Juros Acumulados:</strong> <span id="jurosAcumuladosGlobal">R$ 0,00</span></p>
                        <p><strong>Retorno sobre Investimento:</strong> <span id="roiGlobal">0,00%</span></p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="chartGlobal"></canvas>
                </div>
           </div>
        </section>
        
        <hr class="my-5">
         
        <!-- Simulação Mensal -->
        <h2>Simulação Mensal (12 Meses) <i class="fas fa-calendar-alt"></i></h2>
        <div class="table-responsive">
            <table id="simuladorInvestimentos" class="comparison-table">
                <thead>
                    <tr>
                        <th>Mês</th>
                        <th>Valor Investido (R$)</th>
                        <th>Taxa Anual (%)</th>
                        <th>Taxa Mensal (%)</th>
                       <th>Número de Meses</th>
                       <th>Valor Futuro (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Linhas dos 12 meses -->
                   <tr>
                        <td>Janeiro</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                       <td><span class="taxaMensal">0</span></td>
                        <td><span class="meses">1</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                   <tr>
                        <td>Fevereiro</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                        <td><span class="meses">2</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr>
                       <td>Março</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                       <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">3</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr>
                        <td>Abril</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">4</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr>
                        <td>Maio</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                       <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">5</span></td>
                       <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr>
                       <td>Junho</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                       <td><span class="taxaMensal">0</span></td>
                        <td><span class="meses">6</span></td>
                       <td><span class="valorFuturo">0</span></td>
                    </tr>
                    <tr>
                        <td>Julho</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                       <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">7</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                   <tr>
                        <td>Agosto</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">8</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr>
                       <td>Setembro</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                       <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">9</span></td>
                       <td><span class="valorFuturo">0</span></td>
                    </tr>
                    <tr>
                        <td>Outubro</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">10</span></td>
                        <td><span class="valorFuturo">0</span></td>
                    </tr>
                     <tr>
                       <td>Novembro</td>
                        <td><input type="number" class="investido form-control" value="500"></td>
                       <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                        <td><span class="taxaMensal">0</span></td>
                       <td><span class="meses">11</span></td>
                        <td><span class="valorFuturo">0</span></td>
                    </tr>
                    <tr>
                        <td>Dezembro</td>
                       <td><input type="number" class="investido form-control" value="500"></td>
                        <td><input type="number" class="taxaAnual form-control" value="10" step="0.01"></td>
                       <td><span class="taxaMensal">0</span></td>
                        <td><span class="meses">12</span></td>
                        <td><span class="valorFuturo">0</span></td>
                   </tr>
                    <tr class="total">
                        <td><strong>Total</strong></td>
                       <td id="totalInvestido">R$ 0,00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td id="totalFuturo">R$ 0,00</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="mt-3">
            <button onclick="preencherTodosMeses()" class="btn btn-outline-primary me-2">
                <i class="fas fa-fill-drip"></i> Preencher todos os meses com o valor do primeiro mês
            </button>
            <button onclick="preencherTaxaAnualTodosMeses()" class="btn btn-outline-primary">
                <i class="fas fa-percentage"></i> Preencher taxa anual do primeiro mês em todos os meses
            </button>
        </div>
        
        <div class="chart-container mt-4">
            <canvas id="chartMensal"></canvas>
        </div>
        
        <div class="card bg-dark mt-4">
            <div class="card-header">
                <h3 class="card-title h5">Análise de Retorno <i class="fas fa-chart-line"></i></h3>
            </div>
            <div class="card-body">
                <p><strong>Valor Total Investido:</strong> <span id="analiseInvestido">R$ 0,00</span></p>
                <p><strong>Retorno Total:</strong> <span id="analiseRetorno">R$ 0,00</span></p>
                <p><strong>Percentual de Retorno:</strong> <span id="analisePercentual">0,00%</span></p>
                <p><strong>Taxa Média Mensal Efetiva:</strong> <span id="analiseTaxaMedia">0,00%</span></p>
            </div>
        </div>
    </div>

    <!-- Footer (será carregado via JavaScript) -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/components.js"></script>
    <script src="../assets/js/chart-helpers.js"></script>
    <script src="../assets/js/fix-charts.js"></script>
    <script>
         // Funções de ajuda UI
        function toggleTips() {
            const tipsContent = document.getElementById('tipsContent');
            tipsContent.style.display = tipsContent.style.display === 'block' ? 'none' : 'block';
        }
        
        // Calcular Simulação Global
        function calcularSimulacaoGlobal() {
            // Preparar container do gráfico
            ChartHelpers.prepareChartContainer('chartGlobal');
            
            // Obtém os valores inseridos pelo usuário
            const aporteMensal = parseFloat(document.getElementById("aporteMensal").value) || 0;
            const taxaMensal = parseFloat(document.getElementById("taxaMensal").value) / 100 || 0;
            const quantidadeMeses = parseInt(document.getElementById("quantidadeMeses").value) || 0;
            
            // Verifica se os valores são válidos
            if (aporteMensal <= 0 || taxaMensal <= 0 || quantidadeMeses <= 0) {
                alert("Por favor, insira valores válidos para todos os campos.");
                ChartHelpers.removeLoading('chartGlobal');
                return;
            }
            
            // Arrays para o gráfico
            const labels = [];
            const valoresAcumulados = [];
            const aportesAcumulados = [];
            
            // Calcular o valor futuro somando os fluxos de caixa
            let valorFuturo = 0;
            let totalAportado = 0;
            
            for (let t = 1; t <= quantidadeMeses; t++) {
                labels.push(`Mês ${t}`);
                totalAportado += aporteMensal;
                valorFuturo += aporteMensal * Math.pow(1 + taxaMensal, quantidadeMeses - t);
                valoresAcumulados.push(valorFuturo);
                aportesAcumulados.push(totalAportado);
            }
            
            // Cálculos finais
            const totalInvestido = aporteMensal * quantidadeMeses;
            const jurosAcumulados = valorFuturo - totalInvestido;
            const roi = (jurosAcumulados / totalInvestido) * 100;
            
            // Atualiza os valores no HTML
            document.getElementById("valorFuturoGlobal").textContent = ChartHelpers.formatarMoeda(valorFuturo);
            document.getElementById("totalInvestidoGlobal").textContent = ChartHelpers.formatarMoeda(totalInvestido);
            document.getElementById("jurosAcumuladosGlobal").textContent = ChartHelpers.formatarMoeda(jurosAcumulados);
            document.getElementById("roiGlobal").textContent = roi.toFixed(2) + "%";
            
            // Configurar o gráfico
            const configGrafico = {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Valor Acumulado',
                            data: valoresAcumulados,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Total Investido',
                            data: aportesAcumulados,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 2,
                            fill: true
                        }
                    ]
                },
                options: {
                    ...ChartHelpers.darkThemeConfig(),
                    plugins: {
                        ...ChartHelpers.darkThemeConfig().plugins,
                        tooltip: {
                            ...ChartHelpers.darkThemeConfig().plugins.tooltip,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + ChartHelpers.formatarMoeda(context.raw);
                                }
                            }
                        }
                    }
                }
            };
            
            // Criar o gráfico
            const ctxGlobal = document.getElementById('chartGlobal').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (window.chartGlobal && typeof window.chartGlobal.destroy === 'function') {
                window.chartGlobal.destroy();
            }
            
            // Criar novo gráfico
            window.chartGlobal = new Chart(ctxGlobal, configGrafico);
            
            // Remover indicador de loading
            ChartHelpers.removeLoading('chartGlobal');
        }
        
        // Função para preencher todos os meses com o valor do primeiro mês
        function preencherTodosMeses() {
            const primeiroValor = parseFloat(document.querySelector(".investido").value) || 0;
            document.querySelectorAll(".investido").forEach(input => {
                input.value = primeiroValor;
            });
            calcularInvestimentos();
        }
        
        // Função para preencher a taxa anual do primeiro mês em todos os meses
        function preencherTaxaAnualTodosMeses() {
            const primeiraTaxaAnual = parseFloat(document.querySelector(".taxaAnual").value) || 0;
            document.querySelectorAll(".taxaAnual").forEach(input => {
                input.value = primeiraTaxaAnual;
            });
            calcularInvestimentos();
        }
        
        // Função para calcular o Simulador de Investimentos Mensal
        function calcularInvestimentos() {
            // Preparar container do gráfico
            ChartHelpers.prepareChartContainer('chartMensal');
            
            let totalInvestido = 0;
            let valorFuturoAnterior = 0;
            const valoresMensais = [];
            const labelsMeses = [];
            
            document.querySelectorAll("#simuladorInvestimentos tbody tr").forEach((row, index) => {
                if (row.classList.contains('total')) return; // Ignorar linha de totais
                
                const investidoInput = row.querySelector(".investido");
                if (!investidoInput) return;
                
                const investido = parseFloat(investidoInput.value) || 0;
                const taxaAnual = parseFloat(row.querySelector(".taxaAnual").value) || 0;
                const taxaMensal = Math.pow(1 + taxaAnual / 100, 1 / 12) - 1;
                const meses = index + 1;
                
                labelsMeses.push(row.cells[0].textContent);
                
                // Cálculo do valor futuro acumulado
                const valorFuturo = (valorFuturoAnterior + investido) * (1 + taxaMensal);
                valorFuturoAnterior = valorFuturo;
                valoresMensais.push(valorFuturo);
                
                row.querySelector(".taxaMensal").textContent = (taxaMensal * 100).toFixed(2) + '%';
                row.querySelector(".meses").textContent = meses;
                row.querySelector(".valorFuturo").textContent = ChartHelpers.formatarMoeda(valorFuturo);
                
                totalInvestido += investido;
            });
            
            // Atualiza o total investido e o total futuro
            document.getElementById("totalInvestido").textContent = ChartHelpers.formatarMoeda(totalInvestido);
            document.getElementById("totalFuturo").textContent = ChartHelpers.formatarMoeda(valorFuturoAnterior);
            
            // Análise de retorno
            document.getElementById("analiseInvestido").textContent = ChartHelpers.formatarMoeda(totalInvestido);
            const retornoTotal = valorFuturoAnterior - totalInvestido;
            document.getElementById("analiseRetorno").textContent = ChartHelpers.formatarMoeda(retornoTotal);
            
            const percentualRetorno = totalInvestido > 0 ? (retornoTotal / totalInvestido) : 0;
            document.getElementById("analisePercentual").textContent = ChartHelpers.formatarPorcentagem(percentualRetorno);
            
            // Taxa média mensal efetiva (aproximada pelo rendimento total dividido por 12)
            const taxaMediaMensal = Math.pow(1 + percentualRetorno, 1/12) - 1;
            document.getElementById("analiseTaxaMedia").textContent = ChartHelpers.formatarPorcentagem(taxaMediaMensal);
            
            // Configuração do gráfico
            const configGrafico = {
                type: 'bar',
                data: {
                    labels: labelsMeses,
                    datasets: [
                        {
                            label: 'Valor Acumulado por Mês',
                            data: valoresMensais,
                            backgroundColor: Array(12).fill('rgba(52, 152, 219, 0.8)'),
                            borderColor: Array(12).fill('#3498db'),
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    ...ChartHelpers.darkThemeConfig(),
                    plugins: {
                        ...ChartHelpers.darkThemeConfig().plugins,
                        tooltip: {
                            ...ChartHelpers.darkThemeConfig().plugins.tooltip,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + ChartHelpers.formatarMoeda(context.raw);
                                }
                            }
                        }
                    }
                }
            };
            
            // Criar o gráfico mensal
            const ctxMensal = document.getElementById('chartMensal').getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (window.chartMensal && typeof window.chartMensal.destroy === 'function') {
                window.chartMensal.destroy();
            }
            
            // Criar novo gráfico
            window.chartMensal = new Chart(ctxMensal, configGrafico);
            
            // Remover indicador de loading
            ChartHelpers.removeLoading('chartMensal');
        }
        
        // Atualizar cálculos ao alterar valores
        document.querySelectorAll("input").forEach(input => {
           input.addEventListener("input", calcularInvestimentos);
        });
        
        // Calcular valores iniciais ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            calcularInvestimentos();
            calcularSimulacaoGlobal();
        });
    </script>
</body>
</html>